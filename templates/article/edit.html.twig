{% extends 'layout.html.twig' %}

{% block javascripts %}
    {{ parent()   }}
     {# <script src="{{ asset('JS/ajax.js') }}"></script> #}
     <script>
         $(function() {

            $('#article_category').on('change', function(){
                var category = $(this).val();
                $.ajax({
                    url:'/ajax/category',
                    type: "POST",
                    dataType: "json",
                    async: true,
                    data:{
                        'category': category
                    },
                    success: function (data){
                        if(data.success === 'event'){
                            console.log(data);
                            $('.insertForm').html(`{{ render(controller('App\\Controller\\EventController::formEvent')) }}`); 
                            
                        }
                        //$('div#ajax-results').html(data.output);
                    }
                });
            });

        });
    </script>
{% endblock %}

{% block content %}
    <h1>Ajouter un article</h1>
    
     <div class="row">
        {% include 'aside.html.twig' %}
        <div class="col-md-8">
            <p><a href="{{ path("app_index_index") }}">retour à l'accueil</a></p>

           {{ form_start(form) }} {# ouvre notre balise form #}

                {{ form_row(form.title) }} {# affiche le bloc input pour ce champ #}
                {{ form_row(form.category) }}
                {{ form_row(form.content) }}
                {{ form_row(form.picture) }}
                {# {% if is not null(original_image)%} #}
                {% if form.vars.value.picture is not null %} {# form.vars.value c'est notre entité lié au formulaire, donc l'article #}
                    <img src="{{ asset('uploads/') ~ form.vars.value.picture.filename }}" alt="">
                     {{ form_row(form.remove_image) }}
                {% endif %}
                <div class="insertForm"></div>
                
                <div class="form-btn-group pull-right">
                    <button type="submit" class="btn btn-primary">Enregistrer</button>
                    <a href="{{ path('app_index_index') }}" class="btn btn-default">retour</a>
                </div>
            {{ form_end(form) }} {# ferme notre balise form #}
        </div>
    </div>
{% endblock %}
